name: Actualizar Tasas de Cambio

on:
  schedule:
    # Ejecutar cada 4 horas (minuto 0 de las horas 0, 4, 8, etc.)
    - cron: '0 * * * *'
  workflow_dispatch: # Permite ejecutarlo manualmente desde la pestaña Actions

jobs:
  scrape-and-update:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Permiso clave para que el GITHUB_TOKEN pueda hacer push

    steps:
      - name: Checkout del código
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Instalar dependencias
        run: |
          pip install requests beautifulsoup4 urllib3

      - name: Ejecutar Scraper
        env:
          # GitHub genera este token automáticamente con los permisos de arriba
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO_OWNER: ${{ github.repository_owner }}
          # Extrae el nombre del repo automáticamente
          REPO_NAME: ${{ github.event.repository.name }}
        run: |
          # Asegúrate de que la ruta al script sea correcta según donde lo dejaste
          # Si lo moviste a la raíz:
          python scraper.py
          # Si sigue en netlify/functions:
          # python netlify/functions/scraper.py
